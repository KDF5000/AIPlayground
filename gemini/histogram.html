<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°æ®åˆ†å¸ƒç›´æ–¹å›¾ç”Ÿæˆå™¨</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            color: #333;
            background-color: #f9f9f9;
        }
        h1, h2 {
            text-align: center;
            color: #2c3e50;
        }
        .control-panel {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            text-align: center;
        }
        input[type="file"] {
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 4px;
            width: 80%;
        }
        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            height: 400px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            border-radius: 8px;
            overflow: hidden;
        }
        th, td {
            padding: 12px 15px;
            text-align: center;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #3498db;
            color: white;
            font-weight: 600;
        }
        tr:hover {
            background-color: #f1f1f1;
        }
        .stats-summary {
            margin-bottom: 15px;
            font-size: 0.9em;
            color: #666;
            text-align: right;
        }
    </style>
</head>
<body>

    <h1>ğŸ“Š æ•°æ®åˆ†å¸ƒç›´æ–¹å›¾ç”Ÿæˆå™¨</h1>

    <div class="control-panel">
        <p>è¯·ä¸Šä¼ æ–‡æœ¬æ–‡ä»¶ï¼ˆ.txt æˆ– .csvï¼‰ï¼Œæ¯è¡Œä¸€ä¸ªæ•°å­—</p>
        <input type="file" id="fileInput" accept=".txt,.csv">
        <p id="errorMsg" style="color: red; display: none; margin-top: 10px;"></p>
    </div>

    <div id="resultsArea" style="display: none;">
        <div class="stats-summary" id="statsSummary"></div>

        <div class="chart-container">
            <canvas id="histogramChart"></canvas>
        </div>

        <h2>åˆ†å¸ƒåŒºé—´ç»Ÿè®¡è¡¨</h2>
        <table id="distributionTable">
            <thead>
                <tr>
                    <th>åŒºé—´èŒƒå›´ (Range)</th>
                    <th>é¢‘æ•° (Count)</th>
                    <th>é¢‘ç‡ (Frequency %)</th>
                </tr>
            </thead>
            <tbody>
                </tbody>
        </table>
    </div>

    <script>
        let myChart = null;

        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            
            reader.onload = function(e) {
                const content = e.target.result;
                processData(content);
            };

            reader.readAsText(file);
        });

        function processData(text) {
            const errorMsg = document.getElementById('errorMsg');
            const resultsArea = document.getElementById('resultsArea');
            
            // 1. è§£ææ•°æ®ï¼šæŒ‰è¡Œåˆ†å‰²ï¼Œè½¬æ¢ä¸ºæ•°å­—ï¼Œè¿‡æ»¤æ‰éæ•°å­—
            const lines = text.split(/\r\n|\n/);
            const data = lines
                .map(line => parseFloat(line.trim()))
                .filter(num => !isNaN(num));

            if (data.length === 0) {
                errorMsg.textContent = "æœªåœ¨æ–‡ä»¶ä¸­æ‰¾åˆ°æœ‰æ•ˆçš„æ•°å­—æ•°æ®ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼ã€‚";
                errorMsg.style.display = 'block';
                resultsArea.style.display = 'none';
                return;
            }

            errorMsg.style.display = 'none';
            resultsArea.style.display = 'block';

            // 2. ç»Ÿè®¡è®¡ç®—
            const min = Math.min(...data);
            const max = Math.max(...data);
            const range = max - min;
            const count = data.length;

            // ä½¿ç”¨å¹³æ–¹æ ¹è§„åˆ™ç¡®å®šç”±å¤šå°‘ä¸ªæŸ±å­ (Bins)
            let binCount = Math.ceil(Math.sqrt(count));
            if (binCount < 5) binCount = 5; // è‡³å°‘5ä¸ªåŒºé—´
            if (binCount > 50) binCount = 50; // æœ€å¤š50ä¸ªåŒºé—´ï¼Œé˜²æ­¢å¤ªå¯†é›†

            // å¤„ç†æ‰€æœ‰æ•°å­—éƒ½ç›¸åŒçš„æƒ…å†µ
            if (range === 0) {
                binCount = 1;
            }

            const binWidth = range === 0 ? 1 : range / binCount;
            
            // åˆå§‹åŒ– Bins
            const bins = new Array(binCount).fill(0);
            const binLabels = [];
            
            // 3. å°†æ•°æ®æ”¾å…¥å¯¹åº”çš„ Bin
            data.forEach(num => {
                let index = Math.floor((num - min) / binWidth);
                if (index >= binCount) index = binCount - 1; // å¤„ç†æœ€å¤§å€¼è¾¹ç•Œ
                bins[index]++;
            });

            // ç”Ÿæˆæ ‡ç­¾
            for (let i = 0; i < binCount; i++) {
                const start = min + (i * binWidth);
                const end = start + binWidth;
                // æ ¼å¼åŒ–æ•°å­—ï¼Œä¿ç•™2ä½å°æ•°
                const label = `${formatNum(start)} - ${formatNum(end)}`;
                binLabels.push(label);
            }

            // 4. æ›´æ–° UI
            updateSummary(count, min, max, binCount);
            renderChart(binLabels, bins);
            renderTable(binLabels, bins, count);
        }

        function formatNum(num) {
            // å¦‚æœæ˜¯æ•´æ•°æ˜¾ç¤ºæ•´æ•°ï¼Œå¦åˆ™ä¿ç•™2ä½å°æ•°
            return Number.isInteger(num) ? num : num.toFixed(2);
        }

        function updateSummary(count, min, max, bins) {
            document.getElementById('statsSummary').innerHTML = 
                `æ•°æ®æ€»é‡: <strong>${count}</strong> | æœ€å°å€¼: <strong>${formatNum(min)}</strong> | æœ€å¤§å€¼: <strong>${formatNum(max)}</strong> | åŒºé—´æ•°: <strong>${bins}</strong>`;
        }

        function renderChart(labels, data) {
            const ctx = document.getElementById('histogramChart').getContext('2d');

            // å¦‚æœä¹‹å‰æœ‰å›¾è¡¨ï¼Œå…ˆé”€æ¯
            if (myChart) {
                myChart.destroy();
            }

            myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'é¢‘æ•° (Count)',
                        data: data,
                        backgroundColor: 'rgba(52, 152, 219, 0.6)',
                        borderColor: 'rgba(52, 152, 219, 1)',
                        borderWidth: 1,
                        barPercentage: 1.0, // è®©æŸ±å­ç´§æŒ¨ç€ï¼Œç¬¦åˆç›´æ–¹å›¾å¤–è§‚
                        categoryPercentage: 1.0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'é¢‘æ•°'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'æ•°æ®åŒºé—´'
                            },
                            ticks: {
                                maxRotation: 45,
                                minRotation: 0
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                title: (items) => `åŒºé—´: ${items[0].label}`
                            }
                        }
                    }
                }
            });
        }

        function renderTable(labels, data, totalCount) {
            const tbody = document.querySelector('#distributionTable tbody');
            tbody.innerHTML = '';

            data.forEach((count, index) => {
                const percentage = ((count / totalCount) * 100).toFixed(2) + '%';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${labels[index]}</td>
                    <td>${count}</td>
                    <td>${percentage}</td>
                `;
                tbody.appendChild(row);
            });
        }
    </script>
</body>
</html>
